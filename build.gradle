apply plugin: 'java'
apply plugin: 'war'

group = 'com.github.kazuhito_m'
version = '1'

description = 'executable-war-sample'

war {
    from "$buildDir/classes/main"
    from "$buildDir/resources/main"
    from "$buildDir/unpack-dependencies"
    classpath = classpath.filter {
        !it.name.startsWith('tomcat-embed-') && !it.name.startsWith('ecj-')
    }
    manifest {
        attributes(
                "Main-Class": "com.github.kazuhito_m.TomcatLauncher",
        )
    }
}

task unpackingTomcatJars(type: Copy) {
    from {
        configurations.compile.collect {
            zipTree(it)
        }
    }
    into "$buildDir/unpack-dependencies"
}
war.dependsOn unpackingTomcatJars

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    jcenter()
}


dependencies {
    def tomcatVersion = '7.0.39'
    compile "org.apache.tomcat.embed:tomcat-embed-core:${tomcatVersion}"
    compile "org.apache.tomcat.embed:tomcat-embed-logging-juli:${tomcatVersion}"
    compile "org.apache.tomcat.embed:tomcat-embed-jasper:${tomcatVersion}"
}
